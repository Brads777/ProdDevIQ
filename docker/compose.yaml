# GODMODEDEV Docker Compose
# Run: docker compose -f docker/compose.yaml up -d
# Run with shadcn: docker compose -f docker/compose.yaml --profile shadcn up -d
# Run with graphrag: docker compose -f docker/compose.yaml --profile graphrag up -d

services:
  dev:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ../:/workspace
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1
    working_dir: /workspace
    stdin_open: true
    tty: true

  shadcn:
    profiles: ["shadcn"]
    build:
      context: .
      dockerfile: Dockerfile.shadcn
    ports:
      - "3333:3000"
    volumes:
      - shadcn-workspace:/app
      - shadcn-node-modules:/app/node_modules
    environment:
      - NODE_ENV=development
      - NEXT_TELEMETRY_DISABLED=1
    stdin_open: true
    tty: true

  shadcn-project:
    profiles: ["shadcn-project"]
    build:
      context: .
      dockerfile: Dockerfile.shadcn
    ports:
      - "3333:3000"
    volumes:
      - ${SHADCN_PROJECT_PATH:-./../shadcn-project}:/app
    environment:
      - NODE_ENV=development
      - NEXT_TELEMETRY_DISABLED=1
    stdin_open: true
    tty: true

  qdrant:
    profiles: ["graphrag"]
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_data:/qdrant/storage

  graphrag-api:
    profiles: ["graphrag"]
    build:
      context: ../deviq-graphrag
      dockerfile: Dockerfile
    ports:
      - "8100:8100"
    depends_on:
      - qdrant
    env_file:
      - ../deviq-graphrag/.env
    volumes:
      - ../IDETOOLS:/data/catalog:ro

volumes:
  shadcn-workspace:
  shadcn-node-modules:
  qdrant_data:
